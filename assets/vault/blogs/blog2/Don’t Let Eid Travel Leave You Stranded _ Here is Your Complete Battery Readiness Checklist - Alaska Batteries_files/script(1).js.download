(function ($) {

  const wdtHeadingWidgetHandler = function($scope, $) {

    const $heading_holder = $scope.find('.wdt-heading-holder');
    const $heading_title  = $heading_holder.find('.wdt-heading-title');
    const $heading_wrapper = $heading_title.find('.wdt-heading-split-wrapper');
    const $heading_each_span = $heading_title.find('.wdt-split-heading-title');
    const $heading_each_span_start = $heading_holder.find('.wdt-heading-title-copy-start');
    const $wdt_split_heading_title_start = $heading_each_span_start.find('.wdt-split-heading-title');
    const $heading_each_span_end = $heading_holder.find('.wdt-heading-title-copy-end');
    const $wdt_split_heading_title_end = $heading_each_span_end.find('.wdt-split-heading-title');
    const $data_settings=$scope.data('settings');
    $i ='0';
    $j='0';
    $k='0'; 
    $.each( $heading_each_span, function(){
      $this_element = $(this);
      $this_element.css({ "--char-index": $i});
      $i = parseInt($i)+1;
    } );
    $.each( $wdt_split_heading_title_start, function(){
      $this_element = $(this);
      $this_element.css({ "--char-index": $j});
      $j = parseInt($j)+1;
    } );
    $.each( $wdt_split_heading_title_end, function(){
      $this_element = $(this);
      $this_element.css({ "--char-index": $k});
      $k = parseInt($k)+1;
    } );
      function animation_text_1 (element){
      var $heading_each_span = $(element).find('.wdt-split-heading-title');
      $heading_each_span.each(function(index) {
        $(this).css({
          opacity: 0,
          transform: 'translateY(90px)'
        });
      });
      gsap.fromTo($heading_each_span, {
        opacity: 0,
        y: 40
      }, {
        duration: 1,
        opacity: 1,
        y: 0,
        stagger: 0.03,
        ease: "elastic(1.2, 0.5)",
        scrollTrigger: {
          trigger: element,
          start: "top 70%",
          toggleActions: "play none none none"
        }
      });
    }
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.attributeName === 'class') {
          if ($scope.hasClass('wdt-item-is-inview') && !$scope.data('animation-run')) {
            animation_text_1($heading_title);
            $scope.data('animation-run', true);
          }
        }
      });
    });
    observer.observe($scope[0], { attributes: true });
    if ($scope.hasClass('wdt-item-is-inview') && !$scope.data('animation-run')) {
      animation_text_1($heading_title);
      $scope.data('animation-run', true);
    }
  };
  

  $(window).on('elementor/frontend/init', function () {
    elementorFrontend.hooks.addAction('frontend/element_ready/wdt-heading.default', wdtHeadingWidgetHandler);
  });

})(jQuery);